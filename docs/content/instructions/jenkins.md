# Документация по конвейеру CI/CD Jenkins для приложения с микросервисной архитектурой

## Введение
Этот документ предоставляет руководство по настройке конвейера CI/CD с использованием Jenkins для микросервисного приложения. Конвейер включает этапы разработки и тестирования приложения.

## Предварительные требования
- [Jenkins](https://www.jenkins.io/doc/book/installing/) установлен и настроен.
- [Docker](https://docs.docker.com/get-docker/) установлен на сервере Jenkins.
- Доступ к системе управления версиями (например, [Git](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git)).

## Обзор конвейера
Конвейер CI/CD состоит из следующих этапов:
1. **Checkout:** Получение исходного кода из системы управления версиями.
2. **Build:** Создание Docker-образов для каждого микросервиса.
3. **Развертывание на Dev:** Развертывание микросервисов в среде разработки.
4. **Тестирование:** Выполнение тестов для развернутых микросервисов.
5. **Развертывание на тестовой среде:** Развертывание микросервисов в тестовой среде.
6. **Очистка:** Очистка ресурсов после выполнения конвейера.

## Конфигурация конвейера

### Сценарий конвейера
```groovy
pipeline {
    agent any

    stages {
        stage('Checkout') {
            steps {
                // Получение исходного кода из Git
                git 'https://github.com/your-repo.git'
            }
        }
        stage('Build') {
            steps {
                // Создание Docker-образов для микросервисов
                sh 'docker-compose build'
            }
        }
        stage('Развертывание на Dev') {
            steps {
                // Развертывание микросервисов в среде разработки
                sh 'docker-compose -f docker-compose-dev.yml up -d'
            }
        }
        stage('Тестирование') {
            steps {
                // Выполнение тестов
                sh './run_tests.sh'
            }
        }
        stage('Развертывание на тестовой среде') {
            steps {
                // Развертывание микросервисов в тестовой среде
                sh 'docker-compose -f docker-compose-test.yml up -d'
            }
        }
        stage('Очистка') {
            steps {
                // Очистка ресурсов
                sh 'docker-compose down'
            }
        }
    }
}
```
### Файлы Docker Compose

- **docker-compose-dev.yml:** Конфигурация для среды разработки.
- **docker-compose-test.yml:** Конфигурация для тестовой среды.

### Скрипт выполнения тестов (run_tests.sh)

#!/bin/bash

# Execute tests for microservices
# Add your testing commands here

## Выполнение конвейера

1. Откройте [Jenkins dashboard](http://localhost:8080/).
2. Создайте новый проект конвейера.
3. Настройте конвейер для использования предоставленного файла Jenkinsfile.
4. Запустите конвейер вручную или настройте автоматический запуск по событиям.

Этот документ предоставляет каркас для настройки конвейера CI/CD для микросервисного приложения
с использованием Jenkins. Его можно дополнить в соответствии с конкретными требованиями проекта.

## Jenkins Port forward

```Bash
ssh -L 18081:172.30.48.75:8081
ssh -L 18081:172.30.48.75:8081 dev
http://127.0.0.1:18081/
ssh -L 18081:172.30.48.75:8081 username@172.30.48.103
```
