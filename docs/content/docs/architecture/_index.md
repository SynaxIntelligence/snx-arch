---
tags: [arch, hugo]
title: Архитектура
weight: 3
prev: /docs/getting-started
sidebar:
  open: false
---

## Концепция портала

`Arch Deploy` это концепция синхронизации архитектурных артефактов с ландшафтом развертывания.
Автоматизированный конвейер развертывания архитектуры решения в кластер.

{{< drawio file="/docs/architecture/assets/archdeploy/250501_integration_w_deploy.drawio" >}}

## Архитектура портала

Данная схема представляет процесс интеграции между системами `{{< tooltip "Система 1" >}}` и `{{< tooltip "Система 2" >}}` с использованием `ETL Service` и брокера
`{{< tooltip RabbitMQ >}}`.

{{< zoomimg src="/docs/architecture/assets/etl/250326_integration.png" alt="Архитектура интеграции" >}}

---

> [!WARNING]
> **SUT.** _Direct rendering of .drawio xml_

[//]: # ({{< drawio file="/docs/architecture/products/etl/assets/241031_integration.drawio" >}})

## Описание архитектурных компонентов системы

1. **Система 1-UI (Система 1)**
  - Интерфейс пользователя для проектирования и ведения методологий.
  - Предоставляет REST API для получения модели **Система 1**.

2. **ETL Service** (Обработчик моделей)
  - Получает объектную модель диаграммы из **Система 1**.
  - Преобразует модель в формат **Система 2**.
  - Загружает `.yaml` манифесты в **GitLab**.
  - Загружает метаданные парсинга и управляет конфигурацией маппинга методологий.

3. **Broker** (Очередь сообщений)
  - Обеспечивает подписку на очередь `updateModelQueue`.
  - Получает запросы на обновление модели.
  - Передает запросы от **Система 2** для получения модели по `repositoryId / modelId`.

4. **Система 2-UI / Система 2 Core**
  - Интерфейс и ядро **Система 2**.
  - Выполняет рендер модели и проектирование уровней L3 / Code.
  - Хранит модели в репозитории **GitLab**.

5. **GitLab** (Хранилище `.yaml` манифестов)
  - Репозиторий для хранения сгенерированных манифестов моделей (как правило `pages`) и базовой метамодели.

6. **S3 MinIO** (Объектное хранилище)
  - Хранит резервные копии моделей **Система 2**.
  - _Опционально_. Хранит конфигурацию маппинга методологий.

---

## **Процесс интеграции**
1. Конфигурация маппинга методологий загружается **Администратором** в **Gitlab** или **S3 MinIO** и используется при парсинге.
2. Используя **Система 2 UI** **Пользователь** отправляет запрос на получение модели **Система 1**.
3. **Система 2** направляет запрос в очередь **Broker RMQ** на получение модели.
4. **Broker** получает запрос на обновление модели из очереди `updateModelQueue`.
5. **ETL Service** по подписке на очередь получает и обрабатывает запрос на обновление модели.
6. **ETL Service** выполняет:
   - Запрос модели в **Система 2** по REST API.
   - Преобразование модели **Система 2** в формат **Система 1**.
   - Загрузку `.yaml` манифестов в **GitLab**.
   - Отправку уведомления о статусе операции в очередь **Broker RMQ** для **Система 2 Core**.
7. **GitLab** и **S3 MinIO** хранят сгенерированные модели и настройки.
8. **Пользователь** настраивает файлы манифестов и вносит необходимые корректировки в **GitLab**.
9. **Система 2 Core** обрабатывает модель и передает в **Система 2-UI**.

---

## Диаграмма последовательности

{{< plantuml id="dh_sila_seq_diag" file="/docs/architecture/assets/etl/seq_diag.puml" >}}

## Детализация архитектуры

Для проектирования детальной архитектуры используется библиотека [`C4 Plantuml`](https://github.com/plantuml-stdlib/C4-PlantUML) 

{{% details title="Уровень L1" closed="false" %}}

{{< zoomimg src="/docs/architecture/assets/integration.svg" alt="Архитектура интеграции" >}}

{{% /details %}}

[//]: # (### Уровень L2)
[//]: # ({{< plantuml id="arch_diag_l2" file="/docs/architecture/assets/c4_L2.puml" >}})

{{% details title="Уровень L2" closed="true" %}}

{{< zoomimg src="/docs/architecture/assets/c4_L2.svg" alt="Архитектура интеграции" >}}

{{% /details %}}


## **Заключение**
Данная архитектура обеспечивает автоматизированный обмен моделями между **Система 1** и **Система 2**, используя **ETL Service**, **Broker RMQ**, **GitLab** и **S3 MinIO**.
Это позволяет эффективно управлять методологиями и версиями моделей.

