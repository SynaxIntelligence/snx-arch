---
title: Анализ текущей архитектуры
weight: 12
draft: false
---

## Зависимость от внешних сервисов

**Проблема**: Синхронный запрос на `ins-product-aggregator` создаёт блокирующий поток и жёсткую зависимость от доступности внешних сервисов. Увеличение числа страховых компаний увеличит нагрузку на сервис, а, следовательно, время выполнения синхронных запросов.<br></br>
**Решение**: Декаплинг сервиса `ins-product-aggregator` от основных бизнес-сервисов за счет исключения прямых запросов (точка-точка) и использования брокера с выделенными топиками. Перевод синхронного взаимодействия на асинхронный механизм `pub / sub`.

## Дублирование данных

**Проблема**: Рост объёма хранимых данных с ростом числа страховых компаний. Дубликация данных о продуктах и тарифах в БД `core-bd` и `ins-comp-settlement-db`.<br></br>
**Решение**: Создание выделенной БД для хранения информации о продуктах и тарифах для сервиса `ins-product-aggregator`. Реализация паттерна `transactional outbox` для предотвращения возможной несогласованности при двойной записи (в БД и очередь) сервисом ins-product-aggregator.

## Ошибки взаимодействия сервисов `core-app` и `ins-comp-settlement`

**Проблема**: Иногда команда сталкивается с ошибками взаимодействия между сервисами. Они связаны с задержками ответов или ошибками при взаимодействии с API страховых компаний.<br></br>
**Решение**: `Core-app` отправляет изменения в `ins-comp-settlement` сразу после их появления через брокер. Это снизит количество запросов и обеспечит актуальность данных.
