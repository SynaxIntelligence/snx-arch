---
tags: [arch, etl]
title: ETL Сервис
weight: 12
draft: false
---

## Документация на интеграционный компонент (Система 1 -> Система 2)

## 1. Общая информация
**Название проекта:** Сервис импорта моделей Система 1 -> Система 2  

**Описание:** Проект предназначен для обеспечения взаимодействия между архитектурными системами Система 1 и Система 2

**Функции:** Извлечение архитектурной модели, преобразование модели, загрузка модели в репозиторий Gitlab.

## Дорожная карта проекта

{{< plantuml id="etl_roadmap" file="/docs/architecture/assets/etl/roadmap.puml" >}}

## 2. Архитектура проекта
### 2.1. Контроллеры
Контроллеры обрабатывают входящие HTTP-запросы и взаимодействуют с сервисами.

- **`HealthController`** – проверка состояния сервиса
- **`ModelController`** – управление моделями данных
- **`AdminController`** – административные операции
- **`ModelRpcController`** – обработка RPC-запросов для моделей

### 2.2. Модели (Сущности)
Определяют структуру данных, используемых в системе.

Примеры моделей:
- **`ModelEntity`** – основная модель данных
- **`UserEntity`** – модель пользователя
- **`LogEntry`** – сущность для хранения логов

### 2.3. Сервисы
Сервисы выполняют бизнес-логику и взаимодействуют с базами данных, кэшем и внешними API.

- **`ModelTransferService`** – передача моделей между системами Система 1 и Система 2
- **`ModelTransformService`** – трансформация моделей между форматами систем
- **`GitlabService`** – взаимодействие с GitLab API
- **`CacheService`** – кэширование данных для оптимизации запросов

### 2.4. Файлы конфигурации
Содержат настройки интеграции, такие как маппинг данных и параметры серверов.

- **appsettings.json** – основные настройки проекта
- **config.json** – маппинг свойств систем Система 1 и Система 2

## 3. Развертывание
### 3.1. Требования
- .NET `8.0`
- PostgreSQL `v15.0`: хранение метаданных процессов
- Redis: кэширование
- RabbitMQ: в случае передачи задач на трансформацию моделей через очереди

### 3.2. Установка и запуск
1. Настроить файлы конфигурации `appsettings.json`, `config.json`.

```json {filename="Пример файла маппинга методологии",linenos=table}
{
  "Service": {

    "ModelCodeAttributeId": "e1f78293-a5ea-489a-824e-7e809ec50365",    
    "EntityMapConfig": {
      "EntityMap": {
        "1": "Person"        
      }
    },
    "LinkMapConfig": {
      "LinkMap": {
        "c_idef_input": "Rel",
        "2c9280876870fd2801689455a7060032": "BiRel"
      }
    },   
    
    "AttributeMapConfig": {
      "AttributeMap": {
        "49acc949-c25f-4d0a-bbdb-0c9832bfb98c": "Code"        
      }
    }
  }
}
```
Подробное описание настройки конфигурации представлено в разделе [Настройка конфигурации](#etl-service-config) 

2. Запустить команду для сборки и запуска
3. Проверить доступность сервиса
```sh {filename=helathcheck}
curl http://<server-name>:<server-port>/health
```

## 4. API Эндпоинты
Пример основных маршрутов API.

### 4.1. Проверка состояния
- `GET /health` – возвращает статус сервиса

### 4.2. Работа с моделями
- `GET /model/{id}` – получение модели по ID
- `POST /model` – создание новой модели
- `PUT /model/{id}` – обновление модели
- `DELETE /model/{id}` – удаление модели

### 4.3. Администрирование
- `POST /admin/restart` – перезапуск сервиса
- `GET /admin/logs` – получение логов

### 4.4. RPC Вызовы
- `POST /modelrpc/execute` – выполнение удаленного вызова модели

## 5. Логирование и мониторинг
- Используется `{{< tooltip "Serilog" >}}` для логирования в файл и базу данных
- Мониторинг через **`Prometheus` + `Grafana`**

## 6. Безопасность
- Использование **OAuth2.0 / JWT** для аутентификации
- Ограничение доступа по IP через **Reverse Proxy**
- Валидация входящих данных через **FluentValidation**

## 7. Заключение
Этот проект предназначен для безопасной и эффективной интеграции между Система 1 и Система 2. В случае возникновения вопросов обращаться к технической команде.

