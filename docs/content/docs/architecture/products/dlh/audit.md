---
tags: [arch, dlh]
title: Анализ текущего состояния
weight: 12
draft: false
---

## Проблемные места

### 1. **Устаревшая архитектура DWH**
- Исторически вся бизнес-логика сосредоточена в DWH на базе SQL-сервера.
- Большое количество данных (сотни терабайт) и сложные трансформации замедляют построение отчётов, что снижает производительность и увеличивает TTM.

### 2. **Ограниченная масштабируемость**
- В архитектуру сложно интегрировать новые услуги (фармацевтические компании, производителя медицинского оборудования).
- Интерфейс Power Builder не масштабируется под новые требования бизнеса и является устаревшим решением для взаимодействия с данными.

### 3. **Сложности с аналитикой и доступом к данным**
- Построение сложных отчётов занимает часы из-за большого объёма данных и текущего подхода к их обработке.

### 4. **Отсутствие витрины данных (self-service)*
- Нет централизованного BI портала для сотрудников (генерация отчётов по нужным срезам данных по RBAC / ABAC).

### 5. **Риски при работе с медицинскими данными**
- Медицинские карты, истории болезней и результаты исследований не должны использоваться для аналитики, что требует выделения этих данных в отдельный контур.
- Отсутствует чёткое разграничение данных, используемых для аналитики, и медицинских данных.

## Приоритизация проблем (MoSCoW)

### **Must Have** (Обязательно к выполнению)
1. Создание витрины данных для самообслуживания с возможностью оперативного и user-friendly построения отчётов (метрика - снижение TTM).
2. Архитектурное решение, которое позволит интегрировать новые бизнесы без значительного увеличения бизнес-логики.
3. Выделение медицинских данных в отдельный контур для обеспечения безопасности и соответствия требованиям.

### **Should Have** (Желательно выполнить)
1. Частичная миграция бизнес-логики из DWH в Data Lakehouse.
2. Построение витрин данных для отдельных направлений (финансы, инвентаризация).

### **Could Have** (Можно добавить)
1. Автоматизация обновления витрин данных.
2. Интеграция новых интерфейсов для работы с данными (веб-портал DataHub, Dremio).

### **Won't Have** (Пока не нужно)
1. Аналитика медицинских данных (карты пациентов и истории болезней).
2. Полный отказ от DWH - планируется частичная миграция бизнес-логики и данных.

## **Архитектура платформы управления данными (C4.L2)**

### **Компоненты Data Lakehouse**

1. **Airflow** — оркестрация ETL/ELT-пайплайнов.
2. **S3** — хранилище для сырых и обработанных данных.
3. **Iceberg** — таблицы с поддержкой версионирования и временных срезов данных.
4. **Nessie** — инструмент версионирования данных.
5. **Dremio** — SQL-движок для аналитики данных.
6. **DataHub** — каталог данных и управление метаданными.
7. **Tableau** — инструмент для визуализации и построения отчетов.

### **Контейнеры и их функции**

1. **Оркестрация: `Airflow`**  
   Управление пайплайнами данных:
    - **Сбор данных**: Получение данных из внешних источников (API, базы данных) и запись в `S3`.
    - **Публикацию метаданных**: Обновление DataHub с информацией о новых наборах данных, их метаданными и линией обработки (data lineage).

2. **Уровень хранения: `S3`**  
   Хранит сырые данные и обработанные файлы в формате Parquet.
   Используется как базовое хранилище для таблиц Iceberg.

3. **Уровень обработки и версионирования: `Iceberg` / `Nessie`**  
   Предоставляет возможности управления версиями данных, эволюции схемы и временных срезов.
   Iceberg-таблицы хранятся в `S3` и поддерживают прямой доступ для аналитических запросов.

4. **SQL-запросы и аналитика: `Dremio`**  
   Подключается к Iceberg-таблицам и предоставляет интерфейс SQL-запросов.  
   Обеспечивает быстрый доступ к данным и оптимизацию запросов для `Tableau`.

5. **Каталог метаданных: `DataHub`**  
   Хранит метаданные о всех наборах данных, data lineage.  
   Работает с `Airflow` для автоматического обновления каталога данных после завершения пайплайнов.

6. **Уровень визуализации: `Tableau`**  
   Подключается к `Dremio` для построения дашбордов и отчетов.  
   Self-service инструмент для сотрудников.


