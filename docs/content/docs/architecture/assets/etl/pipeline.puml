@startuml
' Setup dark theme and font
skinparam backgroundColor lightgray
skinparam defaultTextAlignment center
skinparam node {
    BackgroundColor<<template>> #3b82f6
    BackgroundColor<<config>> #2d6cdf
    BackgroundColor<<pipeline>> #1158c7
    BackgroundColor<<rules>> #3e3e3e
    BackgroundColor<<argo>> #5f9ea0
'    FontColor white
'    BorderColor white
}
skinparam defaultFontName "Inter, sans-serif"

' External Templates
package "ğŸ¦Š External CI Templates" <<template>> {
    node "ğŸ“„ .pre.yml" as T1
    node "ğŸ”¢ version.gitlab-ci.yml" as T2
    node "ğŸ³ docker-build-push.gitlab-ci.yml" as T3
    node "ğŸš€ helm-deploy.gitlab-ci.yml" as T4
}

' Source Code Repo
package "ğŸ“ Source Code Repo" <<src>> {
    node "ğŸŒ¿ Source Code" as SRC
}

' External Config
package "ğŸ“ Config Repo" <<config>> {
    node "ğŸŒ¿ Environment Configurations" as CONFIG
}

' Pipeline Flow
package "ğŸ” Pipeline Flow" <<pipeline>> {
    node "ğŸ§¹ Lint" as LINT
    node "ğŸ”¢ Version" as VERSION
    node "ğŸ› ï¸ Build" as BUILD
    node "ğŸ³ Docker" as DOCKER
    node "ğŸš€ Deploy" as DEPLOY
}

' Rules
package "ğŸ“ Rules" <<rules>> {
    node "ğŸ“ changes in CONTEXT_DIR/**/*" as R1
}

' Argo CD
package "Argo" <<argo>> {
    node "ğŸ¯ Argo" as ARGOCD
}

' Connections
T1 --> LINT
T2 --> VERSION
T3 --> DOCKER
T4 --> DEPLOY

LINT --> VERSION
SRC --> BUILD
VERSION --> BUILD
BUILD --> DOCKER
VERSION --> DEPLOY
BUILD --> DEPLOY
DOCKER --> DEPLOY
DEPLOY --> CONFIG
CONFIG --> ARGOCD

R1 --> VERSION
R1 --> BUILD
R1 --> DOCKER
@enduml
